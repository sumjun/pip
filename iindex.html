<!doctype html>
<meta name=viewport content="width=device-width,initial-scale=1">
<body style="margin:0;background:transparent">

<canvas id=c width=640 height=160 style="display:none"></canvas>
<video id=v playsinline muted autoplay style="width:100vw;height:100vh"></video>
<button id=p style="position:fixed;top:12px;left:12px;z-index:9;font-size:16px">PiP</button>

<script>
let text="대기중…";
let lastHash="";

function setFromHash(){
  const h = location.hash ? location.hash.slice(1) : "";
  if (h === lastHash) return;
  lastHash = h;
  try { text = h ? decodeURIComponent(h) : "대기중…"; }
  catch(e){ text = "대기중…"; }
}

const c=document.getElementById("c");
const x=c.getContext("2d");
const v=document.getElementById("v");
v.srcObject=c.captureStream(30);

function wrap(t,X,Y,M,L){
  const a=(t||"").split(" ");
  let l="";
  for(let i=0;i<a.length;i++){
    const b=l+a[i]+" ";
    if(x.measureText(b).width>M && i){
      x.fillText(l,X,Y); l=a[i]+" "; Y+=L;
    } else l=b;
  }
  x.fillText(l,X,Y);
}

function draw(){
  setFromHash();
  x.clearRect(0,0,c.width,c.height);
  x.fillStyle="rgba(0,0,0,0.10)";
  x.fillRect(10,10,c.width-20,c.height-20);
  x.fillStyle="#fff";
  x.font="26px -apple-system";
  wrap(text, 24, 64, c.width-48, 32);
  requestAnimationFrame(draw);
}
draw();

document.getElementById("p").onclick=()=>v.requestPictureInPicture();
</script>
</body>
